machine:
  java:
    version: openjdk8

dependencies:
  pre:
    # Grossness for Android tooling awfulness (see http://stackoverflow.com/a/38381577/129570)
    - mkdir ${ANDROID_HOME}/licenses
    - echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > ${ANDROID_HOME}/licenses/android-sdk-license
  override:
    - ./gradlew dependencies || true # Yes, we have to call it twice, and discard the first result (see above SO link)
    - ./gradlew resolveConfigurations --parallel --console=plain

test:
  override:
    - ./gradlew check build --parallel --info --console=plain
  post:
    - mkdir -p ${CIRCLE_TEST_REPORTS}/junit/
    - find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} ${CIRCLE_TEST_REPORTS}/junit/ \;