machine:
  java:
    version: openjdk8

dependencies:
  pre:
    # Although the Android Gradle plugin claims to install SDK components
    # (https://developer.android.com/studio/intro/update.html#download-with-gradle), it's still rife with shittiness
    # (e.g. http://stackoverflow.com/a/38381577/129570 and https://code.google.com/p/android/issues/detail?id=230654).
    # Thus we install the SDK manually
    -  if [ ! -d "/usr/local/android-sdk-linux/platforms/android-25" ]; then echo y | android update sdk --no-ui --all --filter "android-25"; echo y | android update sdk -u -a -t 3; fi
  override:
    - ./gradlew resolveConfigurations --parallel --console=plain

test:
  override:
    - ./gradlew check build --parallel --info --console=plain
  post:
    - mkdir -p ${CIRCLE_TEST_REPORTS}/junit/
    - find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} ${CIRCLE_TEST_REPORTS}/junit/ \;

general:
  artifacts:
    - app/build/outputs